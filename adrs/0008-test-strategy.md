# 8. Testing strategy

Date: 2024-03-22

## Status

Accepted

## Context

As this is a new project structure, we need to consider the best approach to organising our code and testing it efficiently.

## Decision

### Finance Hub
This follows the existing pattern established in the other Golang "Hub" projects:
* HTTP handlers (`/server`) are unit tested, using `httptest.Recorder` to assert the requests are parsed successfully 
  and the responses are correct.
* The API layer (`/api`) are tested using `httptest.NewServer` to stub the responses.

### Shared
This package contains structs defining the JSON data that is transported between the services. As a result, there isn't
much to test, but anything that needs to be can be covered by simple unit tests.

### Finance API
* HTTP handlers (`/cmd/api`) are unit tested, using `httptest.Recorder` to assert the requests are parsed successfully
  and the responses are correct.
* The service layer (`/internal/service`) is integration tested, using [TestContainers](https://golang.testcontainers.org/modules/postgres/) to 
  provide a fully-migrated Postgres instance per test.
* The data layer (`/internal/store`) is auto-generated by sqlc. As this is statically generated from the database schema into
  typed structs, there is nothing really to test here on top of what has been integration tested in the layer above.

### Cypress
* E2E tests for happy paths and UI interactions.

## Consequences

Due to the amount of auto-generated files, code coverage reports for the project may not fully reflect the true picture.
We can monitor this and adjust our approach/the reports as we build.
